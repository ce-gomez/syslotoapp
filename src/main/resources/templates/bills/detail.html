<!DOCTYPE html>
<!DOCTYPE html>
<html th:replace="~{layout :: layout(~{::content})}" xmlns:th="http://www.thymeleaf.org">

<body>
    <div th:fragment="content">
        <!-- Breadcrumb / Back -->
        <div style="margin-bottom: 16px;">
            <a th:href="@{/bills}"
                style="color: var(--md-sys-color-primary); text-decoration: none; font-weight: 500; display: inline-flex; align-items: center; gap: 8px;">
                <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none"
                    stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <line x1="19" y1="12" x2="5" y2="12"></line>
                    <polyline points="12 19 5 12 12 5"></polyline>
                </svg>
                Volver a Ventas
            </a>
        </div>

        <h2 style="margin-top: 0; margin-bottom: 24px;">Detalle de Venta</h2>

        <!-- Bill Info -->
        <div class="card" style="margin-bottom: 24px;">
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 16px;">
                <div>
                    <span style="display: block; font-size: 12px; color: var(--md-sys-color-outline);">ID Factura</span>
                    <strong style="font-size: 16px;" th:text="${bill.billId}">123</strong>
                </div>
                <div>
                    <span style="display: block; font-size: 12px; color: var(--md-sys-color-outline);">Vendedor</span>
                    <strong style="font-size: 16px;" th:text="${bill.seller.name + ' ' + bill.seller.lastname}">Juan
                        Pérez</strong>
                </div>
                <div>
                    <span style="display: block; font-size: 12px; color: var(--md-sys-color-outline);">Fecha</span>
                    <strong style="font-size: 16px;"
                        th:text="${#temporals.format(bill.date, 'dd-MM-yyyy HH:mm')}">01-01-2023 12:00</strong>
                </div>
                <div>
                    <span style="display: block; font-size: 12px; color: var(--md-sys-color-outline);">Total</span>
                    <strong style="font-size: 24px; color: var(--md-sys-color-primary);"
                        th:text="${'$' + #numbers.formatDecimal(bill.total, 1, 'COMMA', 2, 'POINT')}">$100.00</strong>
                </div>
            </div>
        </div>

        <!-- Add Sale Form -->
        <div class="card"
            style="margin-bottom: 24px; padding: 24px; background-color: var(--md-sys-color-surface-container-low);">
            <h3 style="margin-top: 0; margin-bottom: 16px;">Agregar Venta</h3>
            <form th:action="@{/bills/{id}/sales(id=${bill.billId})}" method="post"
                style="display: flex; gap: 16px; align-items: flex-end; flex-wrap: wrap;">

                <div class="text-field" style="width: 120px;">
                    <label for="number">Número</label>
                    <input type="text" id="number" name="number" required placeholder=" " maxlength="2" pattern="\d{2}"
                        title="Dos dígitos (00-99)" autofocus>
                </div>

                <div class="text-field" style="width: 150px;">
                    <label for="price">Precio</label>
                    <input type="number" id="price" name="price" required placeholder=" " step="0.50" min="0">
                </div>

                <button type="submit" class="btn-filled" style="height: 56px;">+ Agregar</button>
            </form>
        </div>

        <!-- Sales List -->
        <div class="card" style="padding: 0; overflow: hidden;">
            <table style="width: 100%; border-collapse: collapse; text-align: left;">
                <thead style="background-color: var(--md-sys-color-surface-container);">
                    <tr>
                        <th style="padding: 16px; border-bottom: 1px solid var(--md-sys-color-outline-variant);">Número
                        </th>
                        <th style="padding: 16px; border-bottom: 1px solid var(--md-sys-color-outline-variant);">Precio
                        </th>
                        <th style="padding: 16px; border-bottom: 1px solid var(--md-sys-color-outline-variant);">Factor
                        </th>
                        <th style="padding: 16px; border-bottom: 1px solid var(--md-sys-color-outline-variant);">
                            Subtotal</th>
                    </tr>
                </thead>
                <tbody>
                    <tr th:each="sale : ${bill.sales}"
                        style="border-bottom: 1px solid var(--md-sys-color-surface-container);">
                        <td style="padding: 16px; font-weight: bold; font-size: 18px;"
                            th:text="${sale.lotteryNumber.number}">05</td>
                        <td style="padding: 16px;"
                            th:text="${'$' + #numbers.formatDecimal(sale.price, 1, 'COMMA', 2, 'POINT')}">$10.00</td>
                        <td style="padding: 16px;" th:text="${sale.factor}">15.0</td>
                        <td style="padding: 16px; font-weight: bold;"
                            th:text="${'$' + #numbers.formatDecimal(sale.total, 1, 'COMMA', 2, 'POINT')}">$150.00</td>
                    </tr>
                    <tr th:if="${bill.sales.empty}">
                        <td colspan="4" style="padding: 24px; text-align: center; color: var(--md-sys-color-outline);">
                            No hay ventas registradas en esta factura.
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>
    </div>
</body>

</html>