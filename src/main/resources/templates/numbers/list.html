<!DOCTYPE html>
<html lang="es" xmlns:th="http://www.thymeleaf.org" th:replace="~{layouts/base :: layout(~{::title}, ~{::section})}">

<head>
    <meta charset="UTF-8">
    <title>Configuración de Números</title>
</head>

<body>
    <section class="flex gap-3 mb-4 mr-4 max-h-screen w-full">
        <!-- Left Panel - Seller List -->
        <div class="flex flex-col rounded-3xl bg-surface w-md overflow-hidden">
            <header class="flex flex-col p-4">
                <h2 class="text-headline-medium text-on-surface">Vendedores</h2>
                <p class="text-body-medium text-on-surface-variant">Selecciona un vendedor para configurar sus límites
                </p>
            </header>

            <ul class="flex flex-col gap-1 px-2 overflow-y-auto flex-1 pb-4 scrollbar-hide">
                <li th:each="seller : ${sellers}">
                    <a th:href="@{/numbers(sellerId=${seller.sellerId})}"
                        th:classappend="${sellerId != null && seller.sellerId == sellerId} ? 'bg-secondary-container text-on-secondary-container' : ''"
                        class="flex items-center px-4 py-3 gap-4 rounded-2xl hover:bg-surface-container-high transition-colors">
                        <div
                            class="flex items-center justify-center w-10 h-10 rounded-full bg-primary-container text-on-primary-container">
                            <span class="text-label-large"
                                th:text="${seller.name.substring(0,1).toUpperCase() + seller.lastname.substring(0,1).toUpperCase()}">AB</span>
                        </div>
                        <div class="flex flex-col">
                            <span class="text-title-medium" th:text="${seller.name} + ' ' + ${seller.lastname}">Nombre
                                Apellido</span>
                            <span class="text-body-small opacity-70"
                                th:text="${seller.limits.size()} + ' límites configurados'">0 límites</span>
                        </div>
                    </a>
                </li>
            </ul>
        </div>

        <!-- Right Panel - Limits List -->
        <div class="flex flex-col flex-1 rounded-3xl bg-surface overflow-hidden">
            <th:block th:if="${selectedSeller != null}">
                <header class="flex flex-col p-6 border-b border-outline-variant/30">
                    <div class="flex items-center gap-4">
                        <div
                            class="flex items-center justify-center w-12 h-12 rounded-full bg-tertiary-container text-on-tertiary-container">
                            <span class="text-title-medium"
                                th:text="${selectedSeller.name.substring(0,1).toUpperCase() + selectedSeller.lastname.substring(0,1).toUpperCase()}">AB</span>
                        </div>
                        <div class="flex flex-col">
                            <h2 class="text-headline-small text-on-surface"
                                th:text="'Límites de ' + ${selectedSeller.name}">Límites</h2>
                            <p class="text-body-medium text-on-surface-variant">Configuración de montos máximos por
                                número</p>
                        </div>
                    </div>
                </header>

                <div class="flex-1 overflow-y-auto p-6 scrollbar-hide">
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                        <div th:each="limit : ${selectedSeller.limits}"
                            class="flex flex-col p-4 rounded-2xl bg-surface-container-low border border-outline-variant/30 hover:border-primary/30 transition-all">
                            <div class="flex justify-between items-center mb-4">
                                <i th:replace="~{fragments/textIcon :: text-icon(${limit.limited.numberCode})}">00</i>
                                <span class="text-label-small text-on-surface-variant">Monto Actual</span>
                            </div>

                            <form th:action="@{/numbers/limits/{id}(id=${limit.limitId})}" method="POST"
                                class="flex flex-col gap-3">
                                <input type="hidden" name="sellerId" th:value="${selectedSeller.sellerId}">
                                <div class="relative">
                                    <span
                                        class="absolute left-4 top-1/2 -translate-y-1/2 text-body-medium text-on-surface-variant">C$</span>
                                    <input type="number" name="amount" th:value="${limit.amount}" step="1" min="0"
                                        required
                                        class="w-full pl-10 pr-4 py-2 bg-surface-container-highest border-none rounded-xl text-title-medium text-on-surface focus:ring-2 focus:ring-primary outline-none transition-all" />
                                </div>
                                <button type="submit"
                                    class="flex items-center justify-center gap-2 py-2 rounded-full bg-primary text-on-primary text-label-large hover:opacity-90 transition-colors">
                                    <i class="material-symbols-rounded" style="font-size: 18px;">save</i>
                                    Actualizar
                                </button>
                            </form>
                        </div>
                    </div>

                    <div th:if="${#lists.isEmpty(selectedSeller.limits)}"
                        class="flex flex-col items-center justify-center py-20 opacity-50">
                        <i class="material-symbols-rounded" style="font-size: 64px;">search_off</i>
                        <p class="text-body-large mt-4">Este vendedor no tiene límites configurados.</p>
                    </div>
                </div>
            </th:block>

            <th:block th:if="${selectedSeller == null}">
                <div
                    th:replace="~{layouts/emptyPane :: empty-pane('Configuración de Números', 'Selecciona un vendedor de la lista para ver y editar sus límites de venta.')}">
                </div>
            </th:block>
        </div>
    </section>
</body>

</html>